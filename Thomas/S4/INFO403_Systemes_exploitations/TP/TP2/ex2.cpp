//
// Ã‰crire un programme
// qui affiche le nom des fichiers dont le contenu contient la chaine "toto"
//

#include <stdio.h>     /* Pour printf */
#include <stdlib.h>    /* Pour exit, EXIT_SUCCESS, EXIT_FAILURE */
#include <unistd.h>    /* Pour fork */
#include <sys/wait.h>  /* Pour wait */
#include <sys/types.h> /* Pour pid_t */
#include <time.h>
#include <sys/stat.h>
#include <dirent.h>
#include <string.h>

int find(char *fileName,char *strSearch) {

    FILE *f;
    char c;
    int found=0;
    int pos=0;
    int length;

    f = fopen(fileName,"r");
    if( f == NULL )
        return 0;

    length=strlen(strSearch);

    while( fread(&c,1,1,f)>0 && !found ) {

        if( c==strSearch[pos] ) {
            pos++;
        } else {
            if(pos!=0) {
                // On doit rembobiner !
                fseek(f,-pos,SEEK_CUR);
                pos=0;
            }
        }

        found = (pos==length);

    }
    fclose(f);

    return found;

}
int main(int argc,char *argv[]){
    DIR *p;
    char* str;
    struct stat buf;
    struct dirent *de;
    p=opendir("./");
    while((de=readdir(p))!=NULL){
        str=de->d_name;
        if(find(str,(char*)"toto")==1){
            printf("%s \n",de->d_name);
        }

    }
    closedir(p);
    exit(0);
    return 0;
}